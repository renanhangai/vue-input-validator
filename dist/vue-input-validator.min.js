!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueInputValidator=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),n=function(){function t(r){e(this,t),this.$setup(r)}return r(t,[{key:"$setup",value:function(t){var e=Object.freeze({options:t||{},errors:{}});Object.defineProperty(this,"$internal",{writable:!1,enumerable:!1,configurable:!1,value:e})}},{key:"$clear",value:function(t,e){var r=this.$internal.errors[t];if(r&&!(r.length<=0)){var n=[];if(e)for(var a=0,i=r.length;a<i;++a){var s=r[a];e!==s.tag&&n.push(s)}this.$setRaw(t,n)}}},{key:"$update",value:function(e){var r=this.$internal.errors[e],n=void 0;if(!r||r.length<=0)n=!1;else{n=[];for(var a=0,i=r.length;a<i;++a)n.push(t.errorAsString(r[a]));n.first=n[0]}this.$internal.options.vue?this.$internal.options.vue.set(this,e,n):this[e]=n}},{key:"$add",value:function(t,e,r){var n=this[t]||[];n.push({name:t,error:e,tag:r}),this.$setRaw(t,n)}},{key:"$setRaw",value:function(t,e){e&&(e=[].concat(e)),this.$internal.errors[t]=e,this.$update(t)}},{key:"$any",value:function(){for(var t in this.$internal.errors){var e=this.$internal.errors[t];if(e&&e.length>0)return!0}return!1}}],[{key:"errorAsString",value:function(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"Error":""}}]),t}(),a={},i=function(){function t(r,a){e(this,t),a=a||{},this.options=a,this.status={},this.rules={},a.vue?a.vue.util.defineReactive(this,"errors",new n(a)):this.errors=new n(a)}return r(t,[{key:"setValidator",value:function(t,e){this.rules[t]={name:t,rule:e},this.errors.$setRaw(t,!1)}},{key:"removeValidator",value:function(t){this.rules[t]=null}},{key:"setError",value:function(t,e,r){if(this.rules[t]){var n=this.status[t]=this.status[t]||{};n.validationID=null,n.status="error",r&&r.clear===!1&&this.errors.$clear(t,a),this.errors.$add(t,e,e&&e.persistent?null:a)}}},{key:"setValue",value:function(t,e){var r=this,n=this.rules[t];if(!n)return!1;var i=this.status[t]=this.status[t]||{};this.errors.$clear(t,a),i.validationID=null,i.result&&"function"==typeof i.result.cancel&&i.result.cancel();var s=void 0,o=!1;try{s=n.rule(e)}catch(t){s=!1,o=t}if(i.result=s,s&&s.then){var u={};return i.validationID=u,i.status=s.then(function(n){return i.validationID!==u?null:(n===!1?(r.errors.$add(t,!0,a),i.status="error"):(r.errors.$clear(t,a),i.value=e,i.status="success"),i.status)},function(e){return i.validationID!==u?null:(r.errors.$add(t,e,a),i.status="error",i.status)}),i.status}return s===!1?(this.errors.$add(t,o||!0,a),i.status="error",i.status):(this.errors.$clear(t,a),i.value=e,i.status="success",i.status)}},{key:"validate",value:function(){var t=this,e=this.options.Promise||Promise,r=[];for(var n in this.rules){if(this.rules[n]){var a=this.status[n]=this.status[n]||{},i=this.setValue(n,a.value||"");i&&i.then&&r.push(i)}}return e.all(r).then(function(){var r={},n={},a=!1;for(var i in t.rules){if(t.rules[i]){var s=t.status[i]=t.status[i]||{};"success"!==s.status?(r[i]=t.errors[i],a=!0):n[i]=s.value}}return a?e.reject(r):n})}}]),t}();Object.defineProperty(i,"INPUT_TAG",{writable:!1,configurable:!1,value:a});var s=function(){function n(){e(this,n),this.rules={}}return r(n,[{key:"register",value:function(t,e){this.rules[t]={name:t,rule:e}}},{key:"getCallback",value:function(t){var e=this.rules[t];if(!e)throw new Error('Invalid rule "'+t+'"');return e.rule}},{key:"parse",value:function(t){var e=this.parseInternal(t);return this.makeCallbackChain(e)}},{key:"parseInternal",value:function(t){var e=[];if("string"==typeof t)e=e.concat(this.parseInternalString(t));else if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)e=e.concat(this.parseInternal(t));else{if("function"!=typeof t)throw new Error("Invalid rule to parse: "+t);e.push({callback:t})}return e}},{key:"parseInternalString",value:function(t){for(var e=t.split("|"),r=[],n=0,a=e.length;n<a;++n){var i=e[n].split(":"),s=i.shift();r.push({args:i,callback:this.getCallback(s)})}return r}},{key:"makeCallbackChain",value:function(e){if(!e||e.length<=0)return!1;var r=function t(r,n){if(n.cancelled)return!1;for(;n.i<e.length;){var a=e[n.i],i=a.args||[],s=a.callback.apply(null,[r].concat(i));if(n.current=s,s===!1)return!1;if(s&&s.then)return s.then(function(){return n.i+=1,t(r,n)});++n.i}return!0};return r.cancel=function(t){t.cancelled||(t.cancelled=!0,t.current&&"function"==typeof t.current.cancel&&t.current.cancel())},function(e){var n={cancelled:!1,i:0},a=r(e,n);return"object"===(void 0===a?"undefined":t(a))&&(a.cancel=function(){r.cancel(n)}),a}}}]),n}(),o=new s;return{registerRule:function(t,e){o.register(t,e)},install:function(t,e){function r(t,e,r,n){if(!n){var a=r.componentInstance;if(a&&a.$props&&a.$props.name)return a.$props.name}return t.getAttribute("name")}function n(t){return t.target&&null!=t.target.value?t.target.value:t}e=e||{};var a=e.directive||"validate";t.directive(a,{bind:function(t,e,a){var i=a.context.$validator;if(!a.context.$validatorOwn)throw new Error("Invalid validator context.\nDid you set validate: true on the root context component? "+a.context.name);var s=e.modifiers.native||!a.componentInstance,u=r(t,e,a,s);if(!u)throw new Error("Missing attribute name on validator");i.setValidator(u,o.parse(e.value));var l=e.arg||"input";s?(!e.modifiers.dirty&&t.value&&i.setValue(u,t.value),t.addEventListener(l,function(t){i.setValue(u,n(t))})):a.componentInstance.$on(l,function(t){i.setValue(u,n(t))})}}),Object.defineProperty(t.prototype,"$validator",{get:function(){if(this.$options.validate===!0){var r=this.$parent?this.$parent.$validator:null,n=new i(r,{vue:t,Promise:e.Promise});return Object.defineProperty(this,"$validator",{value:n}),Object.defineProperty(this,"$validatorOwn",{value:!0}),n}if("inherit"===this.$options.validate){var a=this.$parent?this.$parent.$validator:null;if(!a)throw new Error("Invalid parent validator to inherit");return Object.defineProperty(this,"$validator",{value:a}),Object.defineProperty(this,"$validatorOwn",{value:!0}),a}return this.$parent.$validator}}),Object.defineProperty(t.prototype,"$errors",{get:function(){return this.$validator.errors}})}}});