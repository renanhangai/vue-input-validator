!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueInputValidator=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),r=function(){function r(e){t(this,r),this.$setup(e)}return e(r,[{key:"$setup",value:function(t){var e=Object.freeze({options:t||{},errors:{}});Object.defineProperty(this,"$internal",{writable:!1,enumerable:!1,configurable:!1,value:e})}},{key:"$clear",value:function(t,e){var r=this.$internal.errors[t];if(r&&!(r.length<=0)){var n=[];if(e)for(var a=0,i=r.length;a<i;++a){var s=r[a];e!==s.tag&&n.push(s)}this.$setRaw(t,n)}}},{key:"$update",value:function(t){var e=this.$internal.errors[t],n=void 0;if(!e||e.length<=0)n=!1;else{n=[];for(var a=0,i=e.length;a<i;++a)n.push(r.errorAsString(e[a]));n.first=n[0]}this.$internal.options.vue?this.$internal.options.vue.set(this,t,n):this[t]=n}},{key:"$add",value:function(t,e,r){var n=this[t]||[];n.push({name:t,error:e,tag:r}),this.$setRaw(t,n)}},{key:"$setRaw",value:function(t,e){e&&(e=[].concat(e)),this.$internal.errors[t]=e,this.$update(t)}},{key:"$any",value:function(){for(var t in this.$internal.errors){var e=this.$internal.errors[t];if(e&&e.length>0)return!0}return!1}}],[{key:"errorAsString",value:function(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"Error":""}}]),r}(),n={},a=function(){function a(e,n){t(this,a),n=n||{},this.options=n,this.status={},this.rules={},n.vue?n.vue.util.defineReactive(this,"errors",new r(n)):this.errors=new r(n)}return e(a,[{key:"setValidator",value:function(t,e){this.rules[t]={name:t,rule:e}}},{key:"removeValidator",value:function(t){this.rules[t]=null}},{key:"setError",value:function(t,e,r){if(this.rules[t]){var a=this.status[t]=this.status[t]||{};a.validationID=null,a.status="error",r&&r.clear===!1&&this.errors.$clear(t,n),this.errors.$add(t,e,e&&e.persistent?null:n)}}},{key:"setValue",value:function(t,e){var r=this,a=this.rules[t];if(!a)return!1;var i=this.status[t]=this.status[t]||{};this.errors.$clear(t,n),i.validationID=null;var s=a.rule(e);if(s&&s.then){var o={};return i.validationID=o,i.status=s.then(function(a){return i.validationID!==o?i.status:(a===!1?(r.errors.$add(t,!0,n),i.status="error"):(r.errors.$clear(t,n),i.value=e,i.status="success"),i.status)},function(e){return i.validationID!==o?i.status:(r.errors.$add(t,e,n),i.status="error",i.status)}),i.status}return s===!1?(this.errors.$add(t,!0,n),i.status="error",i.status):(this.errors.$clear(t,n),i.value=e,i.status="success",i.status)}},{key:"validate",value:function(){var t=this,e=this.options.Promise||Promise,r=[];for(var n in this.rules){if(this.rules[n]){var a=this.status[n]=this.status[n]||{},i=this.setValue(n,a.value||"");i&&i.then&&r.push(i)}}return e.all(r).then(function(){var r={},n={},a=!1;for(var i in t.rules){if(t.rules[i]){var s=t.status[i]=t.status[i]||{};"success"!==s.status?(r[i]=t.errors[i],a=!0):n[i]=s.value}}return a?e.reject(r):n})}}]),a}();return Object.defineProperty(a,"INPUT_TAG",{writable:!1,configurable:!1,value:n}),{install:function(t,e){function r(t,e,r,n){if(!n){var a=r.componentInstance;if(a&&a.$props&&a.$props.name)return a.$props.name}return t.getAttribute("name")}e=e||{};var n=e.directive||"validate";t.directive(n,{bind:function(t,e,n){var a=n.context.$validator;if(!n.context.$validatorOwn)throw new Error("Invalid validator context.\nDid you set validate: true on the root context component? "+n.context.name);var i=e.modifiers.native||!n.componentInstance,s=r(t,e,n,i);if(!s)throw new Error("Missing attribute name on validator");a.setRule(s,e.value);var o=e.arg||"input";i?(!e.modifiers.dirty&&t.value&&a.setValue(s,t.value),t.addEventListener(o,function(t){a.setValue(s,t.target&&t.target.value||t)})):n.componentInstance.$on(o,function(t){a.setValue(s,t.target&&t.target.value||t)})}}),Object.defineProperty(t.prototype,"$validator",{get:function(){if(this.$options.validate===!0){var e=this.$parent?this.$parent.$validator:null,r=new a(e,{vue:t});return Object.defineProperty(this,"$validator",{value:r}),Object.defineProperty(this,"$validatorOwn",{value:!0}),r}if("inherit"===this.$options.validate){var n=this.$parent?this.$parent.$validator:null;if(!n)throw new Error("Invalid parent validator to inherit");return Object.defineProperty(this,"$validator",{value:n}),Object.defineProperty(this,"$validatorOwn",{value:!0}),n}return this.$parent.$validator}}),Object.defineProperty(t.prototype,"$errors",{get:function(){return this.$validator.errors}})}}});