!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueInputValidator=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),r=function(){function r(e){t(this,r),this.$setup(e)}return e(r,[{key:"$setup",value:function(t){var e=Object.freeze({options:t||{},errors:{}});Object.defineProperty(this,"$internal",{writable:!1,enumerable:!1,configurable:!1,value:e})}},{key:"$clear",value:function(t,e){var r=this.$internal.errors[t];if(r&&!(r.length<=0)){var n=[];if(e)for(var i=0,a=r.length;i<a;++i){var s=r[i];e!==s.tag&&n.push(s)}this.$setRaw(t,n)}}},{key:"$update",value:function(t){var e=this.$internal.errors[t],n=void 0;if(!e||e.length<=0)n=!1;else{n=[];for(var i=0,a=e.length;i<a;++i)n.push(r.errorAsString(e[i]));n.first=n[0]}this.$internal.options.vue?this.$internal.options.vue.set(this,t,n):this[t]=n}},{key:"$set",value:function(t,e,r){var n=this[t]||[];n.push({name:t,error:e,tag:r}),this.$setRaw(t,n)}},{key:"$setRaw",value:function(t,e){e&&(e=[].concat(e)),this.$internal.errors[t]=e,this.$update(t)}},{key:"$any",value:function(){for(var t in this.$internal.errors){var e=this.$internal.errors[t];if(e&&e.length>0)return!0}return!1}}],[{key:"errorAsString",value:function(t){return"string"==typeof t?t:""}}]),r}(),n={},i=function(){function i(e,n){t(this,i),n=n||{},this.options=n,this.status={},this.rules={},n.vue?n.vue.util.defineReactive(this,"errors",new r(n)):this.errors=new r(n)}return e(i,[{key:"setRule",value:function(t,e){this.rules[t]={name:t,rule:e}}},{key:"setValue",value:function(t,e){var r=this,i=this.rules[t];if(!i)return!1;var a=this.status[t]=this.status[t]||{};this.errors.$clear(t,n),a.validationID=null;var s=i.rule(e);if(s&&s.then){var u={};return a.validationID=u,a.status=s.then(function(i){return a.validationID!==u?a.status:(!1===i?(r.errors.$set(t,!0,n),a.status="error"):(r.errors.$clear(t,n),a.value=e,a.status="success"),a.status)},function(e){return a.validationID!==u?a.status:(r.errors.$set(t,e,n),a.status="error",a.status)}),a.status}return!1===s?(this.errors.$set(t,!0,n),a.status="error",a.status):(this.errors.$clear(t,n),a.value=e,a.status="success",a.status)}},{key:"validate",value:function(){var t=this,e=this.options.Promise||Promise,r=[];for(var n in this.rules){var i=this.status[n]=this.status[n]||{},a=this.setValue(n,i.value||"");a&&a.then&&r.push(a)}return e.all(r).then(function(){var r={},n={},i=!1;for(var a in t.rules){var s=t.status[a]=t.status[a]||{};"success"!==s.status?(r[a]=t.errors[a],i=!0):n[a]=s.value}return i?e.reject(r):n})}}]),i}();return Object.defineProperty(i,"INPUT_TAG",{writable:!1,configurable:!1,value:n}),{install:function(t,e){e=e||{};var r=e.directive||"validate";t.directive(r,{bind:function(t,e,r){if(!r.context.$validatorOwn)throw new Error("Invalid validator context.\nDid you set validate: true on the root context component? "+r.context.name);var n=t.getAttribute("name");r.context.$validator.setRule(n,e.value),!e.modifiers.dirty&&t.value&&r.context.$validator.setValue(n,t.value);var i=e.arg||"input";t.addEventListener(i,function(t){r.context.$validator.setValue(n,t.target.value)})}}),Object.defineProperty(t.prototype,"$validator",{get:function(){if(this.$root===this||this.$options.validate){var e=this.$parent?this.$parent.$validator:null,r=new i(e,{vue:t});return Object.defineProperty(this,"$validator",{value:r}),Object.defineProperty(this,"$validatorOwn",{value:!0}),r}return this.$parent.$validator}}),Object.defineProperty(t.prototype,"$errors",{get:function(){return this.$validator.errors}})}}});