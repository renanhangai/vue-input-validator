!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueInputValidator=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),r=function(){function r(e){t(this,r),this.$setup(e)}return e(r,[{key:"$setup",value:function(t){var e=Object.freeze({options:t||{},errors:{}});Object.defineProperty(this,"$internal",{writable:!1,enumerable:!1,configurable:!1,value:e})}},{key:"$clear",value:function(t,e){var r=this.$internal.errors[t];if(r&&!(r.length<=0)){var n=[];if(e)for(var a=0,i=r.length;a<i;++a){var s=r[a];e!==s.tag&&n.push(s)}this.$setRaw(t,n)}}},{key:"$update",value:function(t){var e=this.$internal.errors[t],n=void 0;if(!e||e.length<=0)n=!1;else{n=[];for(var a=0,i=e.length;a<i;++a)n.push(r.errorAsString(e[a]));n.first=n[0]}this.$internal.options.vue?this.$internal.options.vue.set(this,t,n):this[t]=n}},{key:"$add",value:function(t,e,r){var n=this[t]||[];n.push({name:t,error:e,tag:r}),this.$setRaw(t,n)}},{key:"$setRaw",value:function(t,e){e&&(e=[].concat(e)),this.$internal.errors[t]=e,this.$update(t)}},{key:"$any",value:function(){for(var t in this.$internal.errors){var e=this.$internal.errors[t];if(e&&e.length>0)return!0}return!1}}],[{key:"errorAsString",value:function(t){return t?"string"==typeof t?t:"string"==typeof t.message?t.message:"Error":""}}]),r}(),n={},a=function(){function a(e,n){t(this,a),n=n||{},this.options=n,this.status={},this.rules={},n.vue?n.vue.util.defineReactive(this,"errors",new r(n)):this.errors=new r(n)}return e(a,[{key:"setValidator",value:function(t,e){this.rules[t]={name:t,rule:e},this.errors.$setRaw(t,!1)}},{key:"removeValidator",value:function(t){this.rules[t]=null}},{key:"setError",value:function(t,e,r){if(this.rules[t]){var a=this.status[t]=this.status[t]||{};a.validationID=null,a.status="error",r&&r.clear===!1&&this.errors.$clear(t,n),this.errors.$add(t,e,e&&e.persistent?null:n)}}},{key:"setValue",value:function(t,e){var r=this,a=this.rules[t];if(!a)return!1;var i=this.status[t]=this.status[t]||{};this.errors.$clear(t,n),i.validationID=null;var s=a.rule(e);if(s&&s.then){var u={};return i.validationID=u,i.status=s.then(function(a){return i.validationID!==u?null:(a===!1?(r.errors.$add(t,!0,n),i.status="error"):(r.errors.$clear(t,n),i.value=e,i.status="success"),i.status)},function(e){return i.validationID!==u?null:(r.errors.$add(t,e,n),i.status="error",i.status)}),i.status}return s===!1?(this.errors.$add(t,!0,n),i.status="error",i.status):(this.errors.$clear(t,n),i.value=e,i.status="success",i.status)}},{key:"validate",value:function(){var t=this,e=this.options.Promise||Promise,r=[];for(var n in this.rules){if(this.rules[n]){var a=this.status[n]=this.status[n]||{},i=this.setValue(n,a.value||"");i&&i.then&&r.push(i)}}return e.all(r).then(function(){var r={},n={},a=!1;for(var i in t.rules){if(t.rules[i]){var s=t.status[i]=t.status[i]||{};"success"!==s.status?(r[i]=t.errors[i],a=!0):n[i]=s.value}}return a?e.reject(r):n})}}]),a}();Object.defineProperty(a,"INPUT_TAG",{writable:!1,configurable:!1,value:n});var i=function(){function r(){t(this,r),this.rules={}}return e(r,[{key:"register",value:function(t,e){this.rules[t]={name:t,rule:e}}},{key:"getCallback",value:function(t){var e=this.rules[t];if(!e)throw new Error('Invalid rule "'+t+'"');return e.rule}},{key:"parse",value:function(t){var e=this.parseInternal(t);return this.makeCallbackChain(e)}},{key:"parseInternal",value:function(t){var e=[];if("string"==typeof t)e=e.concat(this.parseInternalString(t));else if(Array.isArray(t))for(var r=0,n=t.length;r<n;++r)e=e.concat(this.parseInternal(t));else{if("function"!=typeof t)throw new Error("Invalid rule to parse: "+t);e.push({callback:t})}return e}},{key:"parseInternalString",value:function(t){for(var e=t.split("|"),r=[],n=0,a=e.length;n<a;++n){var i=e[n].split(":"),s=i.shift();r.push({args:i,callback:this.getCallback(s)})}return r}},{key:"makeCallbackChain",value:function(t){if(!t||t.length<=0)return!1;var e=function e(r,n){for(n|=0;n<t.length;){var a=t[n],i=a.args||[],s=a.callback.apply(null,[r].concat(i));if(s===!1)return!1;if(s&&s.then)return s.then(function(){return e(r,n+1)});++n}return!0};return function(t){return e(t,0)}}}]),r}(),s=new i;return{registerRule:function(t,e){s.register(t,e)},install:function(t,e){function r(t,e,r,n){if(!n){var a=r.componentInstance;if(a&&a.$props&&a.$props.name)return a.$props.name}return t.getAttribute("name")}function n(t){return t.target&&null!=t.target.value?t.target.value:t}e=e||{};var i=e.directive||"validate";t.directive(i,{bind:function(t,e,a){var i=a.context.$validator;if(!a.context.$validatorOwn)throw new Error("Invalid validator context.\nDid you set validate: true on the root context component? "+a.context.name);var u=e.modifiers.native||!a.componentInstance,o=r(t,e,a,u);if(!o)throw new Error("Missing attribute name on validator");i.setValidator(o,s.parse(e.value));var l=e.arg||"input";u?(!e.modifiers.dirty&&t.value&&i.setValue(o,t.value),t.addEventListener(l,function(t){i.setValue(o,n(t))})):a.componentInstance.$on(l,function(t){i.setValue(o,n(t))})}}),Object.defineProperty(t.prototype,"$validator",{get:function(){if(this.$options.validate===!0){var e=this.$parent?this.$parent.$validator:null,r=new a(e,{vue:t});return Object.defineProperty(this,"$validator",{value:r}),Object.defineProperty(this,"$validatorOwn",{value:!0}),r}if("inherit"===this.$options.validate){var n=this.$parent?this.$parent.$validator:null;if(!n)throw new Error("Invalid parent validator to inherit");return Object.defineProperty(this,"$validator",{value:n}),Object.defineProperty(this,"$validatorOwn",{value:!0}),n}return this.$parent.$validator}}),Object.defineProperty(t.prototype,"$errors",{get:function(){return this.$validator.errors}})}}});