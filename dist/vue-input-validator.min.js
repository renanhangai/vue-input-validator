!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueInputValidator=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),n={required:function(t){return!!t}},i=function(){function i(){t(this,i)}return e(i,null,[{key:"register",value:function(t,e){n[t]=e}},{key:"validate",value:function(t,e,n){return new n.Promise(function(r){r(i._validate(t,e,n))}).then(function(e){if(e===!1||null==e)throw new Error("Invalid value");return e===!0?t:e})}},{key:"_validate",value:function(t,e,r){if(Array.isArray(e))return i._validateArray(t,e,r,0);if("string"==typeof e){e=e.split("|");for(var a=0,l=e.length;a<l;++a)e[a]=e[a].trim();if(e.length>1)return i._validateArray(t,e,r,0);var o=n[e];if(null==o)throw new Error('Invalid rule "'+e+'"');return i._validate(t,o,r)}if("function"==typeof e)return e(t);throw new Error("Invalid rule")}},{key:"_validateArray",value:function(t,e,n,r){return r|=0,n.Promise.resolve(i._validate(t,e[r],n)).then(function(a){if(a===!1||null==a)throw new Error("Invalid value");return a===!0&&(a=t),i._validateArray(a,e,n,r+1)})}}]),i}(),r=function(){function n(e,i){t(this,n),this.$element=e,this.$parentValidator=i,this.$validation=null;var r=e.$el||e,a=e.name||r.getAttribute("name");this.$name=a}return e(n,[{key:"update",value:function(t,e){this.$validation=t.value}},{key:"validate",value:function(t,e){var n=this,r=this.$element.value,a=this.$name;return i.validate(r,this.$validation,this.$parentValidator.$options).catch(function(t){return n.$parentValidator.setError(a,null),Promise.reject(t)})}},{key:"element",get:function(){return this.$element}}]),n}(),a=function(){function n(e,i,r){t(this,n),this.$component=e,this.$parentValidator=i,this.$options=r,this.$childValidators=[],this.$rootValidator=this,this.$parentValidator&&(this.$rootValidator=this.$parentValidator.$rootValidator,this.$parentValidator.$childValidators.push(this)),this._inputElements=[]}return e(n,[{key:"bindElement",value:function(t,e,n){for(var i=null,a=0,l=this._inputElements.length;a<l;++a){var o=this._inputElements[a];if(o.$element===t){i=o;break}}i||(i=new r(t,this),this._elements.push(i)),i.update(e,n)}},{key:"unbindElement",value:function(t){for(var e=[],n=0,i=this._inputElements.length;n<i;++n){this._inputElements[n].$element!==t&&e.push(t)}}},{key:"validateAll",value:function(t,e){var n=this;e=e||{};for(var i=[],r=0,a=this._inputElements.length;r<a;++r)i.push(this._inputElements[r].validate(e));return this.$options.Promise.all(i).then(function(){if(t===!1)return null;for(var i=[],r=0,a=n.$childValidators.length;r<a;++r)i.push(n.$childValidators[r].validateAll(!0,e));return Promise.all(i)})}},{key:"_destroy",value:function(){_.pull(this.$parentValidator.$childValidators,this)}}]),n}();return{install:function(t,e){e={Promise:e.Promise||Promise},t.directive("validate",{bind:function(t,e,n){n.context.$inputValidator.bindElement(t,e,n)},update:function(t,e,n){n.context.$inputValidator.bindElement(t,e,n)},unbind:function(t,e,n){n.context.$inputValidator.unbindElement(t)}}),t.mixin({created:function(){this.$options.validateScope&&Object.defineProperty(this,"$inputValidator",{value:new a(this,this.$inputValidator,e)})},destroyed:function(){this.hasOwnProperty("$inputValidator")&&(this.$inputValidator._destroy(),delete this.$inputValidator)}}),Object.defineProperty(t.prototype,"$inputValidator",{configurable:!0,get:function(){if(this.$parent)return this.$parent.$inputValidator;var t=new a(this,null,e);return Object.defineProperty(this,"$inputValidator",{value:t}),t}})},registerRule:function(t,e){i.register(t,e)}}});